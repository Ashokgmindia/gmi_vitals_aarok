# ============================================================================
# Production Nixpacks Configuration for aarok_frontend
# ============================================================================
# This configuration builds and runs the Express.js server with React frontend
# in a production-ready environment.
# 
# NOTE: This explicitly disables Caddy auto-detection since Express handles
# all routing and static file serving.

[phases.setup]
# Install Node.js 18 LTS and npm 9.x for stable production builds
nixPkgs = ["nodejs_18", "npm-9_x", "openssl"]

[phases.install]
# Install all dependencies (including dev dependencies needed for build)
# Using npm ci for faster, reliable, reproducible builds
# Dev dependencies are needed for TypeScript, Vite, and build tools
cmds = ["npm ci"]

[phases.build]
# Build the React frontend and bundle the Express server
# This creates optimized production assets in dist/public
cmds = ["npm run build"]

# Explicitly do NOT use Caddy - Express server handles everything
# The Express server serves both API routes and static frontend files
# Nixpacks auto-detects static files and adds Caddy, but we override this

# Note: Nixpacks may still detect and install Caddy during build
# but the [start] command below ensures only Express runs at runtime
# If Caddy appears in build logs, it's only being installed, not used

[start]
# Start the production server directly
# NODE_ENV=production is set in package.json start script
# PORT is automatically set by EasyPanel (defaults to 5000)
# The Express server listens on 0.0.0.0:PORT and serves everything
cmd = "npm start"

# ============================================================================
# Production Environment Variables
# ============================================================================
# IMPORTANT: Set these in EasyPanel's Environment section for security
# 
# Required Variables:
#   - PORT: Server port (usually set automatically by EasyPanel)
#   - NODE_ENV: Set to "production" (already in package.json start script)
#   - SESSION_SECRET: Strong random string for JWT signing (REQUIRED in production)
#
# Optional Variables:
#   - DATABASE_URL: PostgreSQL connection string (if using database)
#   - LOG_LEVEL: Logging level (default: info)
#   - TRUST_PROXY: Set to "true" if behind a reverse proxy
#
# Security Notes:
#   - Never commit SESSION_SECRET to version control
#   - Use a strong, random secret (minimum 32 characters)
#   - Generate with: openssl rand -base64 32
# ============================================================================

